<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link type="text/css" rel="stylesheet" href="./styles/shCore.css" /> 
    <link type="text/css" rel="stylesheet" href="./style.css" /> 
    <link type="text/css" rel="stylesheet" href="./styles/shThemeDefault.css" /> 
    <script type="text/javascript" src="./scripts/shCore.js"></script> 
    <script type="text/javascript" src="./scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="./scripts/shBrushJava.js"></script>
    <script type="text/javascript">
      SyntaxHighlighter.all();
    </script> 
  </head>
  <body>
<h1 id="toc_1">Install ZFS on Ubuntu</h1>

<ol>
<li>
Repos hinzufügen, unbedingt durchlaufen lassen!
</li>
</ol>
<p>
sudo -i
apt-add-repository --yes ppa:zfs-native/daily
apt-get update
apt-get install debootstrap ubuntu-zfs
</p>
<ol>
<li>
check to see zfs
</li>
</ol>
<p>
modprobe zfs
dmesg | grep ZFS
</p>
<ol>
<li>
-&gt; ZFS: Loaded module v0.6.0.89-rc12, ZFS pool version 28, ZFS filesystem version 5
</li>
</ol>
<p>
cfdisk
</p>
<ol>
<li>
100MB bootable Partition mit Type BE
</li>
<li>
restlicher Platz mit Type BF
</li>
<li>
checken und anzeigen lassen
</li>
</ol>
<p>
fdisk -l /dev/disk/by-id/scsi-SATA_disk1
</p>
<ol>
<li>
GRUB installieren auf part-1
</li>
</ol>
<p>
mke2fs -m 0 -L /boot/grub -j /dev/disk/by-id/scsi-SATA_disk1-part1
</p>
<ol>
<li>
root pool erstellen
</li>
</ol>
<p>
zpool create rpool /dev/disk/by-id/scsi-SATA_disk1-part2
zfs create rpool/ROOT
zfs create rpool/ROOT/ubuntu-1
zfs umount -a
zfs set mountpoint=/ rpool/ROOT/ubuntu-1
</p>
<ol>
<li>
Kompression einschalten
</li>
</ol>
<p>
zfs set compression=on rpool
zpool set bootfs=rpool/ROOT/ubuntu-1 rpool
zpool export rpool
</p>
<ol>
<li>
Pool importieren
</li>
</ol>
<p>
zpool import -d /dev/disk/by-id -R /mnt rpool
mkdir -p /mnt/boot/grub
</p>
<ol>
<li>
part-1 beachten
</li>
</ol>
<p>
mount /dev/disk/by-id/scsi-SATA_disk1-part1 /mnt/boot/grub
</p>
<ol>
<li>
Minimales System installieren
</li>
</ol>
<p>
debootstrap precise /mnt
</p>
<ol>
<li>
einige Live-CD Inhalte kopieren
</li>
</ol>
<p>
cp /etc/hostname /mnt/etc/
cp /etc/hosts /mnt/etc/
</p>
<ol>
<li>
/mnt/etc/fstab editieren und part-1 hinzugügen
</li>
</ol>
<p>
vi /mnt/etc/fstab
</p>
<ol>
<li>
-&gt; /dev/disk/by-id/scsi-SATA_disk1-part1  /boot/grub  auto  defaults  0  1
</li>
</ol>
<p>
vi /mnt/etc/network/interfaces
</p>
<ol>
<li>
-&gt; # interfaces(5) file used by ifup(8) and ifdown(8)
</li>
<li>
-&gt; auto lo
</li>
<li>
-&gt; iface lo inet loopback
</li>
<li>
-&gt;
</li>
<li>
-&gt; auto eth0
</li>
<li>
-&gt; iface eth0 inet dhcp
</li>
</ol>
<p>
mount --bind /dev /mnt/dev
mount --bind /proc /mnt/proc
mount --bind /sys /mnt/sys
chroot /mnt /bin/bash --login
</p>
<ol>
<li>
Install PPA support
</li>
</ol>
<p>
locale-gen en_US.UTF-8
locale-gen de_DE.UTF-8
apt-get update
apt-get install ubuntu-minimal python-software-properties
</p>
<ol>
<li>
im chroot ZFS installieren
</li>
</ol>
<p>
apt-add-repository --yes ppa:zfs-native/daily
apt-add-repository --yes ppa:zfs-native/grub
apt-get update
apt-get install ubuntu-zfs
apt-get install zfs-initramfs
apt-get dist-upgrade
</p>
<ol>
<li>
Rootpasswort setzten
</li>
</ol>
<p>
passwd root
</p>
<ol>
<li>
Quellen editieren
</li>
</ol>
<p>
vi /ets/apt/sources.list
</p>
<ol>
<li>
-&gt; deb <a href="http://archive.ubuntu.com/ubuntu">http://archive.ubuntu.com/ubuntu</a> precise main universe
</li>
</ol>
<p>
apt-get update
</p>
<ol>
<li>
verify ZFS
</li>
</ol>
<p>
grub-probe /
</p>
<ol>
<li>
-&gt; zfs
</li>
</ol>
<p>
ls /boot/grub/zfs*
</p>
<ol>
<li>
-&gt; /boot/grub/zfs.mod  /boot/grub/zfsinfo.mod
</li>
</ol>
<p>
update-initramfs -c -k all
</p>
<ol>
<li>
-&gt; update-initramfs: Generating /boot/initrd.img-3.2.0-23-generic
</li>
</ol>
<p>
update-grub
</p>
<ol>
<li>
-&gt; Generating grub.cfg ...
</li>
<li>
-&gt; Found linux image: /boot/vmlinuz-3.2.0-23-generic
</li>
<li>
-&gt; Found initrd image: /boot/initrd.img-3.2.0-23-generic
</li>
<li>
-&gt; done
</li>
</ol>
<p>
grep boot=zfs /boot/grub/grub.cfg
</p>
<ol>
<li>
-&gt; linux /ROOT/ubuntu-1/@/boot/vmlinuz-3.2.0-23-generic root=/dev/sda2 ro boot=zfs $bootfs quiet splash $vt_handoff
</li>
<li>
-&gt; linux /ROOT/ubuntu-1/@/boot/vmlinuz-3.2.0-23-generic root=/dev/sda2 ro single nomodeset boot=zfs $bootfs
</li>
</ol>

<ol>
<li>
MBR auf die Festplatte (keine Partition) schreiben
</li>
</ol>
<p>
grub-install $(readlink -f /dev/disk/by-id/scsi-SATA_disk1)
</p>
<ol>
<li>
chroot verlassen
</li>
</ol>
<p>
exit
</p>
<ol>
<li>
Live-CD umounten
</li>
</ol>
<p>
umount /mnt/boot/grub
umount /mnt/dev
umount /mnt/proc
umount /mnt/sys
zfs umount -a
zpool export rpool
</p>
<ol>
<li>
rebooten
</li>
</ol>
<p>
reboot
</p>
<ol>
<li>
als root einloggen und xubuntu nachinstallieren
</li>
</ol>
<p>
apt-get install xubuntu-desktop
</p>


<p>
[ <a href="index.html">Go home</a> ]
</p>

</body>
</html>
